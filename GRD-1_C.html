<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>GRD-1 // INTERCEPT DETECTED</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
<style>
  html, body {
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100%;
  overflow: hidden;
}

#wrap {
  width: 800px;
  height: 600px;
  margin: 0 auto;
  overflow: hidden;
}
:root{
  --pale:#a8c7ff; --pale2:#cfe0ff; --deep:#010b20; --mid:#0a1e47;
  --accent:#66a3ff; --green:#64cd88; --red:#c41616;
}
*{box-sizing:border-box}
body{margin:0;background:#000;color:var(--pale2);font-family:'Press Start 2P',monospace;
     display:flex;justify-content:center;align-items:center;padding-top:0; align-items:center;}
#wrap{width:800px;height:600px;padding:20px;background:#010b20;border:2px solid var(--mid);
      position:relative;overflow:hidden;color:var(--pale2);text-shadow:0 0 6px rgba(168,199,255,.35);}
/* Banner */
.banner{display:flex;align-items:center;justify-content:space-between;background:#081b3f;
  border:1px solid var(--mid);padding:10px 12px;color:var(--pale);letter-spacing:1px;
  box-shadow:inset 0 0 24px rgba(102,163,255,.15);opacity:0;transform:translateY(-8px);
  display:none;transition:opacity .5s ease,transform .5s ease;}
.banner.show{display:flex;opacity:1;transform:translateY(0);}
.leds{display:flex;gap:8px;align-items:center;}
.led{width:8px;height:8px;border:1px solid #0a2a5c;background:#061a3c;}
.led.on{background:#6fb1ff;box-shadow:0 0 10px #6fb1ff;}
.led.fail{background:#c41616;box-shadow:0 0 10px #c41616;}
/* Terminal header (flat pale-blue strip) */
.termHeader{
  position:absolute; left:20px; right:20px; bottom:180px; height:20px;
  background:#0f2a5d; border:1px solid #0a1e47; color:var(--pale2);
  display:none; align-items:center; justify-content:center;
  font-size:10px; letter-spacing:1px; opacity:0; transition:opacity .6s ease;
  box-shadow:inset 0 0 14px rgba(168,199,255,.22);
}
.termHeader.show{ display:flex; opacity:1; }
/* Scope title */
.scopeTitle{position:absolute;left:40px;right:40px;top:86px;display:none;opacity:0;transform:translateY(-6px);
  transition:opacity .4s ease,transform .4s ease;background:#071a3d;border:1px solid var(--mid);color:var(--pale);
  padding:6px 10px;font-size:12px;}
.scopeTitle.show{display:block;opacity:1;transform:translateY(0);}
/* Scope */
.scope{position:absolute;top:110px;left:40px;right:40px;height:220px;border:1px solid var(--mid);
  background:#031331;overflow:hidden;display:none;max-height:0;
  box-shadow:inset 0 0 40px rgba(102,163,255,.08),0 0 20px rgba(102,163,255,.2);}
.scope.unfold{display:block;animation:unfold .9s cubic-bezier(.2,.7,.1,1) forwards;}
.scope.foldup{animation:foldup 1s cubic-bezier(.2,.7,.1,1) forwards;}
@keyframes unfold{0%{max-height:0;opacity:0;}60%{max-height:150px;opacity:.8;}100%{max-height:220px;opacity:1;}}
@keyframes foldup{0%{max-height:220px;opacity:1;}100%{max-height:0;opacity:0;}}
#scope{width:100%;height:100%;display:block;filter:drop-shadow(0 0 6px rgba(168,199,255,.35));}
.grid{position:absolute;inset:0;pointer-events:none;opacity:0;
  background:linear-gradient(to right, rgba(155,188,255,0.25) 1px, transparent 1px),
             linear-gradient(to bottom, rgba(155,188,255,0.25) 1px, transparent 1px);
  background-size:40px 100%,100% 40px;transition:opacity 1s ease;}
.grid.show{opacity:.22;}
/* Console */
#console{position:absolute;left:20px;right:20px;bottom:20px;height:150px;overflow:hidden;
  white-space:pre-wrap;font-size:12px;color:var(--pale2);line-height:1.4em;
  border:1px solid var(--mid);padding:8px;background:#07193a;display:none;opacity:0;transform:translateY(30px);}
#console.unfold{display:block;animation:consoleUp .5s ease-out forwards;}
@keyframes consoleUp{to{opacity:1;transform:translateY(0);}}
.green{color:var(--green);}
.redText{color:#ffd6d6;background:rgba(196,22,22,.25);padding:2px 4px;display:inline-block;}
.linnBox{border:1px solid #5c1010;background:rgba(92,16,16,0.25);padding:2px 4px;display:inline-block;animation:linnFlash 1.2s ease 1;}
@keyframes linnFlash{0%,50%,100%{opacity:1;}25%,75%{opacity:.3;}}
/* Failure */
#failure{position:absolute;left:0;right:0;top:210px;text-align:center;font-size:18px;
  letter-spacing:1px;color:#ffebeb;opacity:0;}
#failure.burn{animation:burn 2s ease-out forwards;}
@keyframes burn{0%{opacity:0;color:#fff;}15%{opacity:1;color:#ff4a4a;text-shadow:0 0 18px rgba(255,80,80,.9);}100%{opacity:.65;color:#c41616;}}
/* Start button */
#start{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);
  background:transparent;border:2px solid var(--accent);color:var(--pale);
  padding:12px 20px;cursor:pointer;z-index:5;animation:pulse 2s infinite alternate;
  font-family:'Press Start 2P',monospace;transition:opacity .6s ease;}
@keyframes pulse{0%{box-shadow:0 0 5px var(--accent);}100%{box-shadow:0 0 20px var(--accent);}}
#start.fade{opacity:0;pointer-events:none;}
/* Glitch overlay */
#glitch{position:absolute;top:0;left:0;width:100%;height:100%;
  background:repeating-linear-gradient(0deg,#fff 0 2px,#7bb7ff 2px,#000 4px);
  opacity:0;mix-blend-mode:screen;pointer-events:none;}
#glitch.flash{animation:glitchFlash .25s steps(2) 1;}
@keyframes glitchFlash{0%{opacity:0;}40%{opacity:1;}100%{opacity:0;}}
</style>

<style>
/* --- Responsive Cinematic Overrides (child) --- */
html, body {
  margin: 0 !important;
  padding: 0 !important;
  width: 100vw !important;
  height: 100vh !important;
  display: flex !important;
  justify-content: center !important;
  align-items: center !important;
  background: #000 !important;
  overflow: hidden !important;
  font-size: clamp(8px, 2vw, 14px) !important;
}
#wrap {
  width: 100% !important;
  max-width: 800px !important;
  aspect-ratio: 4 / 3 !important;
  height: auto !important;
  margin: 0 auto !important;
}
/* Make iframes/canvases scale inside containers if present */
canvas, iframe, video, img {
  max-width: 100% !important;
  height: auto !important;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  try { window.parent.postMessage({type:'ambilight', color:'#66a3ff'}, '*'); } catch(e) { /* ignore */ }
});
</script>

</head>
<body>
<div id="wrap">
  <div class="banner" id="banner">
    <div id="bannerTitle">GRD-1 // INTERCEPT DETECTED</div>
    <div class="leds"><div class="led" id="led1"></div><div class="led" id="led2"></div><div class="led" id="led3"></div></div>
  </div>

  <div class="scopeTitle" id="scopeTitle">&gt; UNKNOWN AUDIO SOURCE – EMERGENCY CHANNEL</div>

  <div class="scope" id="scopeWrap">
    <canvas id="scope" width="720" height="220"></canvas>
    <div class="grid" id="grid"></div>
  </div>

  <div class="termHeader" id="termHeader">[TERMINAL OUTPUT: RECOVERY MODE]</div>
  <div id="console"></div>

  <button id="start">ATTEMPT&nbsp;RECOVERY</button>
  <div id="failure">SYSTEM FAILURE</div>
  <div id="glitch"></div>
</div>

<script>
(function(){
// DOM
const banner = document.getElementById('banner');
const bannerTitle = document.getElementById('bannerTitle');
const leds = [document.getElementById('led1'),document.getElementById('led2'),document.getElementById('led3')];
const consoleBox = document.getElementById('console');
const termHeader = document.getElementById('termHeader');
const scopeWrap = document.getElementById('scopeWrap');
const scopeTitle = document.getElementById('scopeTitle');
const grid = document.getElementById('grid');
const glitch = document.getElementById('glitch');
const startBtn = document.getElementById('start');
const failure = document.getElementById('failure');
const cvs = document.getElementById('scope');
const ctx = cvs.getContext('2d');

// Audio
let ac, analyser;
function ensureAC(){ if(!ac){ const C=window.AudioContext||window.webkitAudioContext; ac=new C(); analyser=ac.createAnalyser(); analyser.fftSize=2048; analyser.smoothingTimeConstant=0.6; }}

// Beeps / tones
function shortBeep(){ ensureAC(); const o=ac.createOscillator(), g=ac.createGain(); o.type='square'; o.frequency.value=740; g.gain.value=0.12; o.connect(g); g.connect(ac.destination); o.start(); setTimeout(()=>{try{o.stop();g.disconnect();}catch(e){}},80); }
function lowDouble(){ ensureAC(); const t=ac.currentTime, g=ac.createGain(); g.gain.value=0.18; g.connect(ac.destination);
  const o1=ac.createOscillator(), o2=ac.createOscillator(); o1.type='square'; o2.type='square';
  o1.frequency.setValueAtTime(440,t); o1.frequency.linearRampToValueAtTime(360,t+0.12);
  o2.frequency.setValueAtTime(360,t+0.16); o2.frequency.linearRampToValueAtTime(300,t+0.28);
  o1.connect(g); o2.connect(g); o1.start(t); o1.stop(t+0.14); o2.start(t+0.16); o2.stop(t+0.3);
  setTimeout(()=>{try{g.disconnect();}catch(e){}},360);
}
function endBeep(){ ensureAC(); const t=ac.currentTime, g=ac.createGain(); g.gain.value=0.15; g.connect(ac.destination);
  const o=ac.createOscillator(); o.type='square'; o.frequency.setValueAtTime(880,t); o.frequency.linearRampToValueAtTime(540,t+0.25);
  o.connect(g); o.start(); o.stop(t+0.3); setTimeout(()=>{try{g.disconnect();}catch(e){}},400);
}
// Ominous start
function ominousStart(){ ensureAC(); const t=ac.currentTime; const master=ac.createGain(); master.gain.value=0.18; master.connect(ac.destination);
  const sweep=ac.createOscillator(); sweep.type='sawtooth'; sweep.frequency.setValueAtTime(600,t); sweep.frequency.exponentialRampToValueAtTime(120,t+0.6);
  const f=ac.createBiquadFilter(); f.type='lowpass'; f.frequency.setValueAtTime(800,t); f.frequency.exponentialRampToValueAtTime(220,t+0.6);
  sweep.connect(f); f.connect(master); sweep.start(t); sweep.stop(t+0.62);
  const th=ac.createOscillator(), g=ac.createGain(); th.type='sine'; th.frequency.setValueAtTime(120,t+0.55);
  g.gain.setValueAtTime(0.0,t+0.55); g.gain.linearRampToValueAtTime(0.25,t+0.60); g.gain.exponentialRampToValueAtTime(0.005,t+0.95);
  th.connect(g); g.connect(master); th.start(t+0.55); th.stop(t+1.0);
  setTimeout(()=>{try{master.disconnect();}catch(e){}},1100);
}
// Static burst (0.5s filtered noise)
function staticBurst(){ ensureAC(); const t=ac.currentTime; const src=ac.createBufferSource();
  const len=Math.floor(ac.sampleRate*0.5); const buf=ac.createBuffer(1,len,ac.sampleRate); const ch=buf.getChannelData(0);
  for(let i=0;i<len;i++){ ch[i]=(Math.random()*2-1)*0.4; } src.buffer=buf;
  const bp=ac.createBiquadFilter(); bp.type='bandpass'; bp.frequency.value=1200; bp.Q.value=0.7;
  src.connect(bp); bp.connect(ac.destination); src.start(t); src.stop(t+0.5);
}
// Dial tone 3s then silence 3s
async function dialTail(){ ensureAC(); const g=ac.createGain(); g.gain.value=0.15; g.connect(ac.destination);
  const a=ac.createOscillator(), b=ac.createOscillator(); a.type='sine'; b.type='sine'; a.frequency.value=350; b.frequency.value=450;
  a.connect(g); b.connect(g); a.start(); b.start(); setTimeout(()=>{try{a.stop();b.stop();g.disconnect();}catch(e){}},3000);
  await new Promise(r=>setTimeout(r,3000)); await new Promise(r=>setTimeout(r,3000));
}

// Waveform (quadratic curves)
function startDraw(){ if(!analyser) return; const w=cvs.width,h=cvs.height; const buf=new Uint8Array(analyser.fftSize);
  (function loop(){ requestAnimationFrame(loop); analyser.getByteTimeDomainData(buf); ctx.clearRect(0,0,w,h);
    ctx.fillStyle='#031331'; ctx.fillRect(0,0,w,h);
    const step=w/(buf.length-1);
    ctx.beginPath();
    for(let i=0;i<buf.length;i++){ const x=i*step; const v=(buf[i]-128)/128; const y=h/2+v*(h*0.45); if(i===0)ctx.moveTo(x,y); else{const px=(i-1)*step; const pv=(buf[i-1]-128)/128; const py=h/2+pv*(h*0.45); const mx=(px+x)/2,my=(py+y)/2; ctx.quadraticCurveTo(px,py,mx,my);} }
    ctx.strokeStyle='rgba(168,199,255,0.35)'; ctx.lineWidth=4; ctx.stroke();
    ctx.beginPath();
    for(let i=0;i<buf.length;i++){ const x=i*step; const v=(buf[i]-128)/128; const y=h/2+v*(h*0.45); if(i===0)ctx.moveTo(x,y); else{const px=(i-1)*step; const pv=(buf[i-1]-128)/128; const py=h/2+pv*(h*0.45); const mx=(px+x)/2,my=(py+y)/2; ctx.quadraticCurveTo(px,py,mx,my);} }
    ctx.strokeStyle='rgba(168,199,255,0.92)'; ctx.lineWidth=2; ctx.stroke();
  })();
}

// TTS (clean) with visual-only envelope — reliability-patched
const Pascoe = `If you can hear this — please, listen carefully.

I've been remotely monitoring your interactions with the Grade-1 archive. Something is responding. The more time you spend inside the system, the stronger it becomes.

I believe it's using your activity — your attention — to rebuild the signal.

The new Ghostwatch On The Night Blu-ray isn't just a release... it's a new broadcast. Another point of entry. Every restoration, every upload, every replay gives it a route back through.

Whatever we encountered at Foxhill Drive — it was never contained. It's adapting to new formats, new circuitry, anything that carries a trace of the original transmission.

I can't prove this yet, but I've logged the same interference pattern in your session that I saw in the archive tapes. Identical.

Don't buy it. Don't play it. If you already have — disconnect your system now.

If this transmission ends abruptly, it means they've—

...is that you, Suzi?`;

async function speakWithEnvelope(){
  if(!('speechSynthesis' in window)) return;
  ensureAC();
  // Cancel anything pending and give synth time to settle
  try{ window.speechSynthesis.cancel(); }catch(e){}
  await new Promise(r=>setTimeout(r,500));

  const env=ac.createGain(); env.gain.value=0.02; env.connect(analyser);
  const carrier=ac.createOscillator(); carrier.type='sawtooth'; carrier.frequency.value=170; carrier.connect(env); carrier.start();

  const u=new SpeechSynthesisUtterance(Pascoe);
  u.lang='en-GB'; u.rate=0.92; u.pitch=0.8; u.volume=1;
  u.onboundary=()=>{ const t=ac.currentTime; try{
    env.gain.cancelScheduledValues(t);
    env.gain.linearRampToValueAtTime(0.24,t+0.03);
    env.gain.linearRampToValueAtTime(0.05,t+0.16);
    carrier.frequency.linearRampToValueAtTime(170+Math.random()*70,t+0.14);
  }catch(e){} };
  return new Promise(res=>{
    u.onend=()=>{ try{carrier.stop();}catch(e){} res(); };
    try{ window.speechSynthesis.speak(u); }catch(e){ res(); }
  });
}

// Helpers
function addSpan(text, cls){ const s=document.createElement('span'); s.textContent=text; if(cls) s.className=cls; consoleBox.appendChild(s); }
function br(){ consoleBox.appendChild(document.createElement('br')); }
function typeLine(text, cls, delay=800){ addSpan(text+"\n", cls); shortBeep(); return new Promise(r=>setTimeout(r,delay)); }

// Terminate visuals
async function terminate(){
  leds.forEach(l=>{ l.classList.remove('on'); l.classList.add('fail'); });
  bannerTitle.textContent="GRD-1 // INTERCEPT TERMINATED";
  scopeWrap.classList.remove('unfold'); scopeWrap.classList.add('foldup'); scopeTitle.classList.remove('show');
  setTimeout(()=>{ failure.classList.add('burn'); }, 300);
  await dialTail();
}

// Main flow
async function run(){
  ensureAC();
  startBtn.classList.add('fade'); setTimeout(()=>{ startBtn.remove(); }, 650);
  // Show terminal header & console
  termHeader.classList.add('show');
  consoleBox.classList.add('unfold');

  // **Added 1s pause after header appears**
  await new Promise(r=>setTimeout(r,1000));

  ominousStart();

  // Recovery beats (green)
  await typeLine("SYSTEM RECOVERY ATTEMPT 03","green",900);
  await typeLine("RESTORING CORE PROCESSES...","green",900);
  await typeLine("SUBSYSTEM STABLE – 74%","green",900);
  await new Promise(r=>setTimeout(r,800));

  // Glitch + static + banner
  glitch.classList.add('flash'); staticBurst(); await new Promise(r=>setTimeout(r,260));
  banner.classList.add('show');

  // LEDs live
  leds.forEach(l=>l.classList.add('on'));

  // Line 1
  await typeLine("UNAUTHORISED CONNECTION DETECTED  |  ORIGIN: MASKED","redText",1000);

  // Line 2: USERNAME:  …pause… LINNIFORD  …pause… | LAST LOGIN
  addSpan("USERNAME:  ","redText"); shortBeep();
  await new Promise(r=>setTimeout(r,1500)); // 1.5 s before name
  addSpan("LINNIFORD","redText linnBox"); lowDouble();
  await new Promise(r=>setTimeout(r,2000)); // 2 s after name
  addSpan("  |  LAST LOGIN: 18/07/1993\n","redText");

  // Pause for readability before waveform
  await new Promise(r=>setTimeout(r,1500));

  // Bring up scope
  scopeTitle.classList.add('show'); scopeWrap.classList.add('unfold'); setTimeout(()=>{ grid.classList.add('show'); }, 220);
  startDraw();

  // Brief settle then dialogue (with reliability patch)
  await new Promise(r=>setTimeout(r,1200));
  await speakWithEnvelope();

  // Final line
  await new Promise(r=>setTimeout(r,400)); br();
  await typeLine("SIGNAL LOST   |   CHANNEL SEALED","",300); endBeep();

  // Terminate
  await terminate();
  // tell the master sequence that Experience C is complete
window.parent.postMessage("experienceComplete", "*");
}

document.getElementById('start').addEventListener('click', run);
})();
</script>
</body>
</html>
